<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ==== 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.) ==== -->
<mapper namespace="jhs">

<!-- 	<select id="getMainBanner_advo" resultType="String">
		select advertisement_num, file_name, url, start_date, period, status
		from tbl_advertisement
		where division = '메인'
		order by advertisement_num
	</select> -->
	
<!-- 	<select id="getCurriList" resultType="com.gukmo.board.model.CurriculumVO">
		select B.board_num as board_num, academy_name, subject,
			   to_char(curriculum_start_date, 'yyyy-mm-dd') as c_start_date, curriculum_period
		from tbl_board B join tbl_curriculum C
		on B.board_num = C.fk_board_num		
	</select> -->
	
	
	
	<!-- 메인 게시판 영역 -->
	<select id ="getFreeBoardList" resultType="com.gukmo.board.model.BoardVO">
		select board_num,nickname, point as writer_point , profile_image,
		       detail_category , subject,
		       content , write_date, views, comment_cnt, like_cnt
		from
		(
		select board_num, B.nickname as nickname, M.point as point, M.profile_image as profile_image,
		       detail_category , subject,
		       content , write_date, views, comment_cnt, like_cnt
		from tbl_board B join tbl_member M
		on B.nickname = M.nickname
		where detail_category = '자유게시판' 
		order by write_date desc
		)
		where rownum between 1 and 5
	</select>
	
	
	<select id ="getStudyBoardList" resultType="com.gukmo.board.model.BoardVO">
		select board_num,nickname, point as writer_point, profile_image,
		       detail_category , subject,
		       content , write_date, views, comment_cnt, like_cnt
		from
		(
		select board_num, B.nickname as nickname, M.point as point, M.profile_image as profile_image,
		       detail_category , subject,
		       content , write_date, views, comment_cnt, like_cnt
		from tbl_board B join tbl_member M
		on B.nickname = M.nickname
		where detail_category = '스터디' 
		order by write_date desc
		)
		where rownum between 1 and 5
	</select>
	
	
	<select id ="getQnaBoardList" resultType="com.gukmo.board.model.BoardVO">
		select board_num,nickname, point as writer_point, profile_image,
		       detail_category , subject,
		       content , write_date, views, comment_cnt, like_cnt
		from
		(
		select board_num, B.nickname as nickname, M.point as point, M.profile_image as profile_image,
		       detail_category , subject,
		       content , write_date, views, comment_cnt, like_cnt
		from tbl_board B join tbl_member M
		on B.nickname = M.nickname
		where detail_category = 'QnA' 
		order by write_date desc
		)
		where rownum between 1 and 5
	</select>
	
	
	<select id ="getReviewBoardList" resultType="com.gukmo.board.model.BoardVO">
		select board_num,nickname, point as writer_point, profile_image,
		       detail_category , subject,
		       content , write_date, views, comment_cnt, like_cnt
		from
		(
		select board_num, B.nickname as nickname, M.point as point, M.profile_image as profile_image,
		       detail_category , subject,
		       content , write_date, views, comment_cnt, like_cnt
		from tbl_board B join tbl_member M
		on B.nickname = M.nickname
		where detail_category = '수강/취업후기' 
		order by write_date desc
		)
		where rownum between 1 and 5
	</select>
	
	
	
	<!-- 검색창 영역 -->
	<!-- 해시태그 검색용 mapping -->
	<resultMap id="searchList" type="com.gukmo.board.model.BoardVO">
		<id property="board_num" column="board_num"/>
		<result property="subject" column="subject"/>
		<result property="content" column="content"/>
		<result property="write_date" column="write_date"/>
		<collection property="hashtags" column="hashtag" javaType="java.util.ArrayList" ofType="com.gukmo.board.model.HashtagVO">
			<id property="hashtag" column="hashtag"/>
		</collection>
	</resultMap>
	
	<select id ="getTotalCnt" parameterType="HashMap" resultType="int">
		select count(*)
		from(
		    select dense_rank() OVER (order by B.board_num desc) rno,
		           board_num, subject, content, hashtag, B.write_date as write_date         
		    from tbl_board B left join tbl_hashtag_board_map HM
		    on B.board_num = HM.fk_board_num left join tbl_hashtag H
		    on HM.hashtag_num = H.hashtag_num
			where 1 = 1
				<if test= 'searchWord != ""'>
				and subject like '%'||lower(#{searchWord})||'%'
			    or content like '%'||lower(#{searchWord})||'%'
			    or hashtag like '%'||lower(#{searchWord})||'%'
			   </if>
		)V
	</select>
	
	

	<select id = "getSearchList" parameterType="HashMap" resultMap="searchList">
		select board_num, subject, content, hashtag, write_date
		from(
		    select dense_rank() OVER (order by B.board_num desc) rno,
		           board_num, subject, content, hashtag, B.write_date as write_date         
		    from tbl_board B left join tbl_hashtag_board_map HM
		    on B.board_num = HM.fk_board_num left join tbl_hashtag H
		    on HM.hashtag_num = H.hashtag_num
			where 1 = 1
				<if test= 'searchWord != ""'>
				and subject like '%'||lower(#{searchWord})||'%'
			    or content like '%'||lower(#{searchWord})||'%'
			    or hashtag like '%'||lower(#{searchWord})||'%'
			   </if>
		)V
		where rno between #{startRno} and #{endRno}
	</select>

	
</mapper>